<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Latin Vocab!</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <!-- Don't use this in production: -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.1/papaparse.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      /** Main component */
      const Main = (props) => {
        // state
        const [fields, setFields] = React.useState([]); // data field names
        const [vocab, setVocab] = React.useState([]); // data items
        const [sortField, setSortField] = React.useState(""); // field to sort on
        const [filteredSortedVocabIndices, setFilteredSortedVocabIndices] =
          React.useState([]); // array of data item indices
        const [currentIndex, setCurrentIndex] = React.useState(0); // current data item index
        const [showFlashcard, setShowFlashcard] = React.useState(true);
        const [showVocabList, setShowVocabList] = React.useState(false);

        // load Latin vocab CSV file at startup
        React.useEffect(() => {
          const url = "./Latin Vocabulary - Vocab.csv";
          fetch(url)
            .then(function (response) {
              console.log(url + " -> " + response.ok);
              if (response.ok) {
                return response.text();
              }
              throw new Error("Error message.");
            })
            .then(
              function (data) {
                // parse CSV file
                const results = Papa.parse(data, { header: true }); // object with { data, errors, meta }
                console.log(results);
                setVocab(results.data);
                setFields(results.meta.fields);
              }.bind(this)
            )
            .catch(function (err) {
              console.log("failed to load ", url, err.message);
            });
        }, []);

        React.useEffect(() => {
          const fsvi = vocab.map((item, index) => index);
          console.log(fsvi);
          setFilteredSortedVocabIndices(fsvi);
        }, [vocab.length, sortField]);

        // render page content!
        return (
          <div
            style={{
              display: "flex",
              flexDirection: "column",
              justifyContent: "center",
            }}
          >
            {/* FlashCard Section */}
            <div>
              <button onClick={() => setShowFlashcard(!showFlashcard)}>
                {(showFlashcard ? "Hide" : "Show") + " Flashcard"}
              </button>
              {!!showFlashcard && (
                <FlashCard
                  vocab={vocab}
                  currentIndex={currentIndex}
                  setCurrentIndex={setCurrentIndex}
                />
              )}
            </div>

            {/* VocabList Section */}
            <div>
              <button
                onClick={() => setShowVocabList(!showVocabList)}
                style={{ marginBottom: 10 }}
              >
                {(showVocabList ? "Hide" : "Show") + " Vocab List"}
              </button>
              {!!showVocabList && (
                <VocabList
                  fields={fields}
                  vocab={vocab}
                  currentIndex={currentIndex}
                  sortField={sortField}
                  setSortField={setSortField}
                />
              )}
            </div>
          </div>
        );
      };

      /**
       * FlashCard component
       */
      const FlashCard = (props) => {
        // props
        const { vocab, currentIndex, setCurrentIndex } = props;

        // state
        const [showEnglish, setShowEnglish] = React.useState(false);

        // data
        const beginIndex = 0;
        const endIndex = vocab.length > 0 ? vocab.length - 1 : 0;

        // safely clamp array index
        const clampIndex = (newIndex) => {
          if (newIndex < 0) return 0;
          if (newIndex > vocab.length) return vocab.length - 1;
          return newIndex;
        };

        // click handler
        const onBeginningClick = (number) => {
          setCurrentIndex(0);
        };

        // click handler
        const onPreviousClick = (number) => {
          setCurrentIndex(clampIndex(currentIndex - number));
        };

        // click handler
        const onNextClick = (number) => {
          setCurrentIndex(clampIndex(currentIndex + number));
        };

        // click handler
        const onEndClick = (number) => {
          setCurrentIndex(vocab.length - 1);
        };

        // click handler
        const onShowHideClick = () => {
          setShowEnglish(!showEnglish);
        };

        // render
        return (
          <div
            style={{
              display: "flex",
              flexDirection: "column",
              justifyContent: "center",
              alignItems: "center",
            }}
          >
            {"index: " + currentIndex}
            <Card line={vocab[currentIndex]} showDetails={showEnglish} />
            <div>
              <Button
                disabled={currentIndex === beginIndex}
                onClick={onBeginningClick}
              >
                {"| <"}
              </Button>
              <Button
                disabled={currentIndex < 10}
                onClick={() => onPreviousClick(10)}
              >
                {"<- 10"}
              </Button>
              <Button
                disabled={currentIndex === beginIndex}
                onClick={() => onPreviousClick(1)}
              >
                Previous
              </Button>
              <Button
                style={{ backgroundColor: "yellow" }}
                onClick={onShowHideClick}
              >
                {showEnglish ? "Hide" : "Show"}
              </Button>
              <Button
                disabled={currentIndex >= endIndex}
                onClick={() => onNextClick(1)}
              >
                Next
              </Button>
              <Button
                disabled={currentIndex > endIndex - 10}
                onClick={() => onNextClick(10)}
              >
                {"10 ->"}
              </Button>
              <Button disabled={currentIndex >= endIndex} onClick={onEndClick}>
                {"> |"}
              </Button>
            </div>
          </div>
        );
      };

      /**
       * VocabList component
       */
      const VocabList = (props) => {
        // props
        const { fields, vocab, currentIndex, sortField, setSortField } = props;

        // styles
        const rowHeaderCellStyle = { flex: 1, cursor: "pointer" };
        const rowItemCellStyle = { flex: 1 };
        const englishCellStyle = { flex: 2 };
        const latinCellStyle = { flex: 2 };
        const sortHeaderCellStyle = { fontWeight: "bold" };

        const getFieldStyle = (fieldName) => {
          if (fieldName === "English") {
            return englishCellStyle;
          }
          if (fieldName === "Latin") {
            return latinCellStyle;
          }
          return {};
        };
        const getSortHeaderStyle = (fieldName) => {
          if (fieldName === sortField) {
            return sortHeaderCellStyle;
          }
          return {};
        };

        // render
        return (
          <div style={{ display: "flex", flexDirection: "column" }}>
            {/* Header Row */}
            <div
              style={{
                display: "flex",
                flexDirection: "row",
              }}
            >
              {fields.map((field, index) => (
                <div
                  key={index}
                  style={{
                    ...rowHeaderCellStyle,
                    ...getFieldStyle(field),
                    ...getSortHeaderStyle(field),
                  }}
                  onClick={() => setSortField(field)}
                >
                  {field}
                </div>
              ))}
            </div>

            {/* Item Rows */}
            {vocab.map((item, itemIndex) => (
              <div
                key={itemIndex}
                style={{
                  display: "flex",
                  flexDirection: "row",
                  backgroundColor: itemIndex % 2 == 0 ? "white" : "AliceBlue",
                  fontWeight: itemIndex === currentIndex ? "bold" : "normal",
                }}
              >
                {fields.map((field, fieldIndex) => (
                  <div
                    key={fieldIndex}
                    style={{
                      ...rowItemCellStyle,
                      ...getFieldStyle(field),
                    }}
                  >
                    {item[field]}
                  </div>
                ))}
              </div>
            ))}
          </div>
        );
      };

      /**
       * Button component
       */
      const Button = (props) => {
        return (
          <button
            {...props}
            style={{
              ...props.style,
              margin: 10,
              padding: 10,
              fontSize: 20,
            }}
          >
            {props.children}
          </button>
        );
      };

      /**
       * Card component
       */
      const Card = (props) => {
        const { line, showDetails = false } = props;
        const h2Style = {
          fontStyle: "italic",
          fontWeight: "normal",
        };
        if (!line) {
          return null;
        }
        return (
          <div
            style={{
              textAlign: "center",
              minHeight: 400,
            }}
          >
            <h1 style={{ fontSize: 50 }}>{line.Latin}</h1>
            {showDetails && (
              <div>
                <h2 style={h2Style}>{line.English}</h2>
                <h2 style={h2Style}>
                  {line["Part of Speech, Declension, Gender, etc."]}
                </h2>
                <h2 style={h2Style}>{line.Special}</h2>
                <h2 style={h2Style}>{"Page: " + line["Page Number"]}</h2>
              </div>
            )}
          </div>
        );
      };

      /** Main Render! */
      ReactDOM.render(<Main />, document.getElementById("root"));
    </script>
  </body>
</html>
